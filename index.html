<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Binary Tree Operations Animation</title>
<style>
  :root{
    --node:#2d9cdb;
    --highlight:#e67e22;
    --done:#27ae60;
  }
  body { font-family: Arial, sans-serif; margin:0; background:#f9f9f9; }
  header { padding:12px; background:#fff; border-bottom:1px solid #ddd; display:flex; align-items:center; gap:8px; }
  h1 { font-size:18px; margin:0; }
  input,button { padding:8px 12px; border-radius:6px; font-size:14px; }
  button { border:none; cursor:pointer; background:var(--node); color:white; }
  button:hover { background:#217dbb; }
  button.secondary { background:#eee; color:#333; }
  #main { display:flex; height:calc(100vh - 50px); }
  #canvasWrap { flex:1; }
  canvas { width:100%; height:100%; display:block; background:#fff; }
  aside { width:280px; border-left:1px solid #ddd; padding:12px; background:#fafafa; font-size:14px; }
</style>
</head>
<body>
<header>
  <h1>Binary Tree – Operations Animation</h1>
  <input id="newValue" placeholder="Value" />
  <button id="addRoot">Add Root</button>
  <button id="addLeft" class="secondary">Add Left</button>
  <button id="addRight" class="secondary">Add Right</button>
  <button id="deleteBtn" class="secondary">Delete Node</button>
  <button id="demoBtn">Autoplay Demo</button>
  <button id="heightBtn">Height</button>
  <button id="countBtn">Count Nodes</button>
  <button id="leafBtn">Leaf Nodes</button>
  <button id="degreeBtn">Degree</button>
</header>

<div id="main">
  <div id="canvasWrap"><canvas id="treeCanvas"></canvas></div>
  <aside>
    <p><b>Operations:</b></p>
    <ul>
      <li><b>Height</b> – max levels in tree.</li>
      <li><b>Count Nodes</b> – total nodes in tree.</li>
      <li><b>Leaf Nodes</b> – nodes with no children.</li>
      <li><b>Degree</b> – maximum children of any node (0–2 in binary tree).</li>
    </ul>
    <p>Use <b>Autoplay Demo</b> to load sample tree and try operations.</p>
  </aside>
</div>

<script>
const canvas=document.getElementById("treeCanvas"),ctx=canvas.getContext("2d");
function resize(){canvas.width=canvas.clientWidth;canvas.height=canvas.clientHeight;}
window.addEventListener("resize",resize);resize();

class Node{
  constructor(val){this.val=val;this.left=null;this.right=null;this.x=0;this.y=0;}
}
class Tree{
  constructor(){this.root=null;}
  addRoot(v){if(!this.root)this.root=new Node(v);}
  findParent(target,node=this.root){
    if(!node)return null;
    if(node.left===target||node.right===target)return node;
    return this.findParent(target,node.left)||this.findParent(target,node.right);
  }
}
const tree=new Tree();let selected=null,dragging=null,offset={x:0,y:0};

function autoLayout(node,x,y,spread){
  if(!node)return;
  node.x=x;node.y=y;
  if(node.left)autoLayout(node.left,x-spread,y+80,spread/1.8);
  if(node.right)autoLayout(node.right,x+spread,y+80,spread/1.8);
}
function drawTree(highlightMap={}){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(tree.root){autoLayout(tree.root,canvas.width/2,60,canvas.width/4);
    drawEdges(tree.root);drawNodes(tree.root,highlightMap);}
}
function drawEdges(node){
  if(node.left){line(node,node.left);drawEdges(node.left);}
  if(node.right){line(node,node.right);drawEdges(node.right);}
}
function line(a,b){ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);ctx.stroke();}
function drawNodes(node,highlightMap){
  let color=highlightMap[node]||"#2d9cdb";
  ctx.beginPath();ctx.arc(node.x,node.y,20,0,2*Math.PI);
  ctx.fillStyle=color;ctx.fill();ctx.stroke();
  if(node===selected){ctx.lineWidth=3;ctx.strokeStyle="red";ctx.stroke();ctx.lineWidth=1;ctx.strokeStyle="black";}
  ctx.fillStyle="white";ctx.textAlign="center";ctx.fillText(node.val,node.x,node.y+5);
  if(node.left)drawNodes(node.left,highlightMap);
  if(node.right)drawNodes(node.right,highlightMap);
}

// hit test
function hit(x,y,node){if(!node)return null;
  if(Math.hypot(node.x-x,node.y-y)<20)return node;
  return hit(x,y,node.left)||hit(x,y,node.right);}
canvas.addEventListener("mousedown",e=>{
  const r=canvas.getBoundingClientRect();const x=e.clientX-r.left,y=e.clientY-r.top;
  const n=hit(x,y,tree.root);
  if(n){selected=n;dragging=n;offset.x=x-n.x;offset.y=y-n.y;}
  else selected=null;
  drawTree();
});
canvas.addEventListener("mousemove",e=>{
  if(dragging){const r=canvas.getBoundingClientRect();
    dragging.x=e.clientX-r.left-offset.x;dragging.y=e.clientY-r.top-offset.y;drawTree();}
});
canvas.addEventListener("mouseup",()=>dragging=null);

// buttons
document.getElementById("addRoot").onclick=()=>{
  const v=document.getElementById("newValue").value;if(!v)return;
  tree.addRoot(v);selected=tree.root;drawTree();};
document.getElementById("addLeft").onclick=()=>{
  if(!selected)return alert("Select node");
  const v=document.getElementById("newValue").value;if(!v)return;
  if(!selected.left)selected.left=new Node(v);drawTree();};
document.getElementById("addRight").onclick=()=>{
  if(!selected)return alert("Select node");
  const v=document.getElementById("newValue").value;if(!v)return;
  if(!selected.right)selected.right=new Node(v);drawTree();};
document.getElementById("deleteBtn").onclick=()=>{
  if(!selected)return alert("Select node");
  if(tree.root===selected){tree.root=null;}
  else{const p=tree.findParent(selected);
    if(p.left===selected)p.left=null;if(p.right===selected)p.right=null;}
  selected=null;drawTree();};

// operations
async function animateHeight(node){
  if(!node)return 0;
  drawTree({[node]:"orange"});
  await sleep(700);
  let l=await animateHeight(node.left);
  let r=await animateHeight(node.right);
  drawTree({[node]:"green"});await sleep(500);
  return 1+Math.max(l,r);
}
async function animateCount(node,count=0){
  if(!node)return 0;
  drawTree({[node]:"orange"});await sleep(500);
  let l=await animateCount(node.left);let r=await animateCount(node.right);
  drawTree({[node]:"green"});await sleep(400);
  return 1+l+r;
}
async function animateLeaves(node){
  if(!node)return 0;
  let sum=0;
  if(!node.left&&!node.right){
    drawTree({[node]:"orange"});await sleep(500);
    drawTree({[node]:"green"});await sleep(400);
    return 1;
  }
  sum+=await animateLeaves(node.left);
  sum+=await animateLeaves(node.right);
  return sum;
}
async function animateDegree(node,maxDeg=0){
  if(!node)return 0;
  let deg=(node.left?1:0)+(node.right?1:0);
  drawTree({[node]:"orange"});await sleep(400);
  let l=await animateDegree(node.left);let r=await animateDegree(node.right);
  drawTree({[node]:"green"});await sleep(300);
  return Math.max(deg,l,r);
}
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}

document.getElementById("heightBtn").onclick=async()=>{
  if(!tree.root)return alert("Empty tree");
  let h=await animateHeight(tree.root);
  alert("Height = "+h);
};
document.getElementById("countBtn").onclick=async()=>{
  if(!tree.root)return alert("Empty tree");
  let c=await animateCount(tree.root);
  alert("Total Nodes = "+c);
};
document.getElementById("leafBtn").onclick=async()=>{
  if(!tree.root)return alert("Empty tree");
  let l=await animateLeaves(tree.root);
  alert("Leaf Nodes = "+l);
};
document.getElementById("degreeBtn").onclick=async()=>{
  if(!tree.root)return alert("Empty tree");
  let d=await animateDegree(tree.root);
  alert("Degree of Tree = "+d);
};

// demo tree
document.getElementById("demoBtn").onclick=()=>{
  tree.root=null;tree.addRoot(50);
  tree.root.left=new Node(30);tree.root.right=new Node(70);
  tree.root.left.left=new Node(20);tree.root.left.right=new Node(40);
  tree.root.right.left=new Node(60);tree.root.right.right=new Node(80);
  drawTree();
};
drawTree();
</script>
</body>
</html>
